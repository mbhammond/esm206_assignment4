---
title: "Juvenile Hare in Bonanza Creek Forest"
author: "Margaret Hammond"
date: "11/5/2021"
output: html_document
---

```{r setup, include = TRUE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
library(broom)
library(equatiomatic)
library(lubridate)
library(kableExtra)
library(effsize)
```

## Data Introduction

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know what’s contained in the report.
**DELETE**

## Data Analysis
A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.
Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

## Juvenile Hare Initial Investigation

### Annual Juvenile Hare Trap Counts
In this section, we will be analyzing the annual juvenille hare trap countrs. The data will be rangled to include the total number of juvenile hare trappings during each year of the study. This data will then be compiled into a data visualization of the counts by year. 


#### Read in Data
Read in Bonanza snowshoe hare data.

```{r}
snowshoe <- read_csv(here("data", "bonanza_hares.csv"))
```

#### Wrangle the Data
Wrangle the data to only have juvenile weight and create a year column. 

```{r}
juvenile_snowshoe <- snowshoe %>% 
  filter(age == "j") %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date))

juvenile_snowshoe_count <- juvenile_snowshoe %>% 
  count(year)
```

#### Data Visualization
Data visualization of juvenile snowshoe hare count by year. 

```{r}
ggplot(data = juvenile_snowshoe_count, aes(x = year, y = n)) +
  geom_bar(stat = "identity",
           fill = "pink2", 
           color = "black") +
  labs(x = "Year",
       y = "Amount of Snowshoe Hares",
       title = "Juvenille Snowshoe Hare Count by Year",
       caption = "Figure 1. Juvenile Snowshoe hare count per year in Bonanza 
       Creek Experimental Forest from 1999 - present.")
```

#### Data Visualization Observations
Then, in 3 - 4 sentences below your figure, describe major takeaways from your graph about total snowshoe hare trappings at the site. You might consider:
- What were the minimum and maximum counts of juvenile hare trappings?
- Mean or median annual number of juvenile hares trapped?
General/notable trends?
- These are absolute counts, but this count is also impacted by effort (e.g. the number of days and number of traps in the study each year). What would you suggest be done moving forward (you are not expected to actually do this) to standardize the juvenile hare population in future analyses?
**DELETE THIS**

### Juvenile Hare Weight by Sex and Site

#### Data Visualization
Plot of juvenile hare weight by sex and site. Using the average weight of sex to explore the relationship. 

```{r}

weight_stats <- juvenile_snowshoe %>% 
  mutate(sex = case_when(
    sex == "f" ~ "F",
    sex == "m" ~ "M"
  )) %>% 
  mutate(grid = case_when(
    grid == "bonrip" ~ "Bonanza Riparian",
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonbs" ~ "Bonanza Black Spruce"
  )) %>% 
  filter(sex != "NA") 

weight_stats_sum <- weight_stats %>% 
  group_by(sex, grid) %>% 
  summarize( # Creating a summary table of weight by sex for the seperate sites
    mean_weight = mean(weight, na.rm = TRUE),
    median_weight = median(weight, na.rm = TRUE), # Median, sd, and n included for personal data observations
    sd_weight = sd(weight, na.rm = TRUE), 
    sample_size = n()
  )


ggplot(data = weight_stats_sum, 
       aes(x = sex, y = mean_weight, fill = sex)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ grid, scale = "free") +
  scale_fill_manual(values = c("pink3", "blue", "grey")) + #pink for female, blue for male
 # theme()
  labs (x = "Sex",
        y = "Weight (gram)",
        title = "Average Weight of Juvenile Hare by Sex at each Site",
        caption = "Figure 2. Average weight (gram) of juvenile hare by 
        sex at the Bonanza Creek Experimental Forest from 1999-present",
        fill = "Sex")
  
```

#### Data Visualization Observations
Then, in 2 - 3 sentences below your visualization(s) describe in text the main takeaways that you would want the audience to understand from your figures. ***DELETE THIS***

### Juvenile Weight Comparison

#### Exploratory Data Visualization
Exploratory data visualization of the relationship between male and female juvenile hare weight. Done so with a QQ plot and histogram to explore assumptions of your t-test.

```{r, include = FALSE}
weight_compare_explore <- juvenile_snowshoe %>% 
  filter(sex != "NA") %>% 
  group_by(sex) %>% 
   mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male"))

ggplot(data = weight_compare_explore, aes(x = weight)) +
  geom_histogram(bins = 15) +
  facet_wrap(~sex)

ggplot(data = weight_compare_explore, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)
```


#### Table Comparison of Male and Female weight
Compare mean weights for juvenile male and female snowshoe hares. 

```{r}

weight_compare <- juvenile_snowshoe %>% 
  filter(sex != "NA") %>% # Filter out NA for sex
  group_by(sex) %>% 
   mutate(sex = case_when(
    sex == "f" ~ "Female", # Change f to Female for cleaner table 
    sex == "m" ~ "Male")) %>% # Change m to Male for cleaner table
  summarize(
    mean_weight = 
      round(mean(weight, na.rm = TRUE), 2), # Use round() to show only 2 decimal places
    sd_weight = 
      round(sd(weight, na.rm = TRUE), 2),
    sample_size = n()
  )

weight_compare %>% 
  kable(col.names = c("Sex",
                      "Mean weight (g)", 
                      "Standard deviation (g)",
                      "Sample size (n)"),
        caption = "Figure 3. Juvenile Hare Weight (g) Comparison by Sex") %>% 
  kable_styling(full_width = TRUE)

```

#### T-Test and Cohen's d
Run a t-test and cohen's d to explore the relationship between female juvenile hare weight to male juvenile hare weight. 

```{r}
female_juvenile <- juvenile_snowshoe %>% 
  filter(sex == "f") %>% 
  drop_na(weight) %>% 
  pull(weight)

male_juvenile <- juvenile_snowshoe %>% 
  filter(sex == "m") %>% 
  drop_na(weight) %>% 
  pull(weight)


t.test(x = female_juvenile, y = male_juvenile)

cohen.d(female_juvenile, male_juvenile)
```


#### Data Analysis
A 2 - 3 sentence comprehensive statement of the means comparison, including at least:
The actual difference in means
Effect size (Cohen's *d*) (see effsize::cohen.d() example in the Lab 5 key)
Outcome of an unpaired two-sample t-test
***DELETE THIS***


### Juvenile Weight & Hind Foot Length

#### Wrangle Data
Wrangle the data to include weight and hind foot length for juvenile hares.

```{r}
weight_feet <- juvenile_snowshoe %>% 
  select(weight, hindft)
```

#### Data Visualization
Data visualization of the relationship between wright and hind foot length in juvenile hares.
```{r}
ggplot(data = weight_feet, 
       aes(x = hindft, y = weight)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Juvenile Hare Weight by Hind Feet Length",
       x = "Hind Foot Length (mm)",
       y = "Weight (g)",
       caption = "Figure 4. Juvenile hare hind feet (mm) by weight (g) in Bonanza Experimental Forest")
```

#### Linear Regression
Linear regression line to visualize how juvenile showshoe hare weight changes with respect to hind foot length.

```{r}
weight_feet_lm <- lm(hindft ~ weight, 
                 data = weight_feet)
weight_feet_lm_tidy <- tidy(weight_feet_lm) # get lm stats
weight_feet_lm_glance <- glance(weight_feet_lm)

weight_feet_lm_tidy
weight_feet_lm_glance
cor.test(weight_feet$hindft, weight_feet$weight)
```

#### Data Interpretation
On average, we expect a 1 mm increase in hind feet length to be associated with a `r round(weight_feet_lm_tidy$estimate[2], 2)` increase in body mass. 
In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? ***DELETE THIS*** DO I NEED PEARSONS R??

### Summary
Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine) ***DELETE THIS***

## End of Assignment 4
